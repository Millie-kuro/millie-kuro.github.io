<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="styles.css" />
    </head>
    <body>
        <script>
            // Video ID
            var id = "";
            // Time of current video, in hh:mm:ss
            var time = "";
            
            var tag = document.createElement("script");
            tag.src = "https://www.youtube.com/iframe_api";
            var firstSc = document.getElementsByTagName("script")[0];
            firstSc.parentNode.insertBefore(tag, firstSc);

            var player;
            
            function updateID() {
                var url = document.getElementById("url").value;
                if (url.indexOf("youtu.be/") > 0) {
                    id = url.split("youtu.be/")[1];
                } else if (url.indexOf("?v=") > 0) {
                       id = url.split("?v=")[1];
                }
//                document.getElementById("id").innerHTML = "<span>"+id+"</span>";
            }
            
            // Load video if not already loaded.
            function loadVideo() {
                if (player == null) {
                    player = new YT.Player("playerDiv", {
                           width: 720,
                           height: 480,
                           videoId: id,
                       });
                } else {
                    player.loadVideoById({videoId: id});
                }
            }
            
            function getTime() {
                var totalSec = Math.floor(player.getCurrentTime());
                var hr = Math.floor(totalSec / 3600);
                var min = Math.floor((totalSec % 3600) / 60);
                var sec = Math.floor(totalSec % 60);
                if (hr < 10) {hr = "0" + hr;}
                if (min < 10) {min = "0" + min;}
                if (sec < 10) {sec = "0" + sec;}
                time = hr + ":" + min + ":" + sec;
            }
            
            function updateTimestamp() {
                getTime();
                document.getElementById("time").innerHTML = "<span>Comment at " + time + "</span>";
            }
            
            function addToComment() {
                var comm = document.getElementById("comment").value;
                document.getElementById("total").value += time + " " + comm + "\n";
                document.getElementById("comment").value = "";
            }
            
            function saveToFile() {
            	var fileDl = document.createElement("a");
                fileDl.setAttribute("href","data:text/plain;charset=utf-8," + encodeURIComponent(document.getElementById("total").value));
                fileDl.setAttribute("download","yt-timecommgen.txt");
                fileDl.style.display = "none";
                document.body.appendChild(fileDl);
                fileDl.click();
                document.body.removeChild(fileDl);
            }
            
        </script>

        <h1>YouTube Timestamp Comment Generator</h1>
        <p>
            Watch and timestamp your favourite videos with ease!
            <br />
            This page takes care of the timestamping for you! All you need to do is stop the video where you want to write your comment. Then, type your comment into the below text field, and click "Add to Comment".
            It will add the proper timestamp to the front of the comment for you.
            
            Do note that if you're using this for the YouTube chapters feature, you will need a timestamp at the start of the video (0h, 0m, 0s) for it to work.
            
            Thank you for using this page!
        </p>
        
        <span>Video URL </span><input id="url" oninput="updateID()"/>
        <button onclick="loadVideo()">Load Video</button>
        <br/>
        
        <div><span id="id"/></div>
        <div id="playerDiv"></div>
        
        <div>
            <span id="time">Comment at Time</span>
            <button onclick="addToComment()">Add Timestamped Comment</button>
            <br/>
            <textarea id="comment" cols="110" oninput="updateTimestamp()"></textarea>
        </div>
        <div>
            <span>Timestamp Comment</span>
            <button onclick="saveToFile()">Save to Files</button>
            <br/>
            <textarea id="total" rows="8" cols="110" value=""></textarea>
        </div>
        <br />
        <a href="index.html">Go Back to the Main Page</a>
    </body>
</html>
